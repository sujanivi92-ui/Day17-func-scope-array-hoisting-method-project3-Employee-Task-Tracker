<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Shopping Cart</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .content {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .products {
            flex: 2;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .cart-section {
            flex: 1;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .product-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        
        .product-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }
        
        .product-info {
            padding: 15px;
        }
        
        .product-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .product-price {
            font-size: 1.3rem;
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 15px;
        }
        
        .add-to-cart {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            font-size: 1rem;
            transition: background 0.3s;
        }
        
        .add-to-cart:hover {
            background: #2980b9;
        }
        
        .cart-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }
        
        .cart-items {
            margin-bottom: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .item-details {
            flex: 1;
        }
        
        .item-name {
            font-weight: bold;
        }
        
        .item-price {
            color: #7f8c8d;
        }
        
        .remove-item {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .cart-summary {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .total {
            font-weight: bold;
            font-size: 1.2rem;
            border-top: 1px solid #ddd;
            padding-top: 10px;
        }
        
        .discount-section {
            margin-bottom: 20px;
        }
        
        .discount-input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 70%;
            margin-right: 10px;
        }
        
        .apply-discount {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .checkout-btn {
            background: #9b59b6;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 5px;
            width: 100%;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .checkout-btn:hover {
            background: #8e44ad;
        }
        
        .message {
            padding: 10px;
            margin-top: 20px;
            border-radius: 5px;
            text-align: center;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .empty-cart {
            text-align: center;
            color: #7f8c8d;
            padding: 20px;
        }
        
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            
            .products {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Online Shopping Cart</h1>
            <p class="subtitle">Shop with ease and convenience</p>
        </header>
        
        <div class="content">
            <div class="products">
                <!-- Product cards will be generated by JavaScript -->
            </div>
            
            <div class="cart-section">
                <h2 class="cart-title">Your Cart</h2>
                
                <div class="cart-items">
                    <!-- Cart items will be generated by JavaScript -->
                    <div class="empty-cart">Your cart is empty</div>
                </div>
                
                <div class="cart-summary">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">$0.00</span>
                    </div>
                    <div class="summary-row">
                        <span>Discount:</span>
                        <span id="discount">$0.00</span>
                    </div>
                    <div class="summary-row total">
                        <span>Total:</span>
                        <span id="total">$0.00</span>
                    </div>
                </div>
                
                <div class="discount-section">
                    <input type="text" class="discount-input" placeholder="Enter discount code">
                    <button class="apply-discount">Apply Discount</button>
                </div>
                
                <button class="checkout-btn">Proceed to Checkout</button>
                
                <div id="message" class="message"></div>
            </div>
        </div>
    </div>

    <script>
        // Global scope for cart array
        var cart = [];
        
        // Products data
        const products = [
            { id: 1, name: "Wireless Headphones", price: 99.99, image: "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60", inStock: true },
            { id: 2, name: "Smartphone", price: 599.99, image: "https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60", inStock: true },
            { id: 3, name: "Laptop", price: 899.99, image: "https://images.unsplash.com/photo-1496181133206-80ce9b88a853?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60", inStock: true },
            { id: 4, name: "Smart Watch", price: 199.99, image: "https://images.unsplash.com/photo-1523275335684-37898b6baf30?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60", inStock: true },
            { id: 5, name: "Tablet", price: 349.99, image: "https://images.unsplash.com/photo-1561154464-82e9adf32764?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60", inStock: true },
            { id: 6, name: "Gaming Console", price: 499.99, image: "https://images.unsplash.com/photo-1606144042614-b2417e99c4e3?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60", inStock: false }
        ];
        
        // Function expressions
        const addToCart = function(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                // Check if product is already in cart
                const existingItem = cart.find(item => item.id === productId);
                
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    cart.push({
                        id: product.id,
                        name: product.name,
                        price: product.price,
                        quantity: 1,
                        inStock: product.inStock
                    });
                }
                
                updateCartDisplay();
                showMessage(`${product.name} added to cart!`, 'success');
            }
        };
        
        // Arrow function
        const removeFromCart = (productId) => {
            const itemIndex = cart.findIndex(item => item.id === productId);
            
            if (itemIndex !== -1) {
                const itemName = cart[itemIndex].name;
                cart.splice(itemIndex, 1);
                updateCartDisplay();
                showMessage(`${itemName} removed from cart.`, 'success');
            }
        };
        
        // Function expression
        const calculateTotal = function() {
            // Using reduce() to calculate total
            const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            
            // Block scope in conditionals (if total > 500)
            let discount = 0;
            if (subtotal > 500) {
                // Using block scope for discount calculation
                const discountRate = 0.1; // 10% discount
                discount = subtotal * discountRate;
            }
            
            // Local scope for temporary discountedPrice
            const discountedPrice = subtotal - discount;
            
            return {
                subtotal: subtotal,
                discount: discount,
                total: discountedPrice
            };
        };
        
        // Arrow function
        const applyDiscount = (code) => {
            // Using some() to check if discount code is valid
            const validCodes = ['SAVE10', 'WELCOME15', 'SUMMER20'];
            const isValid = validCodes.some(validCode => validCode === code.toUpperCase());
            
            if (isValid) {
                // Apply discount based on code
                let discountRate = 0;
                
                // Block scope for discount calculation
                if (code.toUpperCase() === 'SAVE10') {
                    discountRate = 0.1;
                } else if (code.toUpperCase() === 'WELCOME15') {
                    discountRate = 0.15;
                } else if (code.toUpperCase() === 'SUMMER20') {
                    discountRate = 0.2;
                }
                
                const totals = calculateTotal();
                const discountAmount = totals.subtotal * discountRate;
                
                return {
                    subtotal: totals.subtotal,
                    discount: discountAmount,
                    total: totals.subtotal - discountAmount
                };
            } else {
                return calculateTotal();
            }
        };
        
        // Function declaration (hoisted)
        // Try using checkout() before defining it
        checkout();
        
        function checkout() {
            // Using every() to check if all items are in stock
            const allInStock = cart.every(item => item.inStock);
            
            if (cart.length === 0) {
                showMessage('Your cart is empty!', 'error');
                return;
            }
            
            if (!allInStock) {
                showMessage('Some items in your cart are out of stock. Please remove them before checkout.', 'error');
                return;
            }
            
            // Using map() to apply tax to all items
            const taxRate = 0.08; // 8% tax
            const itemsWithTax = cart.map(item => {
                return {
                    ...item,
                    tax: item.price * taxRate,
                    total: item.price * (1 + taxRate) * item.quantity
                };
            });
            
            // Using join() to create a checkout summary string
            const summary = itemsWithTax.map(item => 
                `${item.name} (x${item.quantity}) - $${item.total.toFixed(2)}`
            ).join('\n');
            
            const totals = calculateTotal();
            const finalTotal = totals.total * (1 + taxRate);
            
            alert(`Checkout Summary:\n\n${summary}\n\nTax: $${(totals.total * taxRate).toFixed(2)}\nFinal Total: $${finalTotal.toFixed(2)}\n\nThank you for your purchase!`);
            
            // Clear cart after checkout
            cart = [];
            updateCartDisplay();
            showMessage('Order placed successfully!', 'success');
        }
        
        // Function to update cart display
        function updateCartDisplay() {
            const cartItemsContainer = document.querySelector('.cart-items');
            const subtotalElement = document.getElementById('subtotal');
            const discountElement = document.getElementById('discount');
            const totalElement = document.getElementById('total');
            
            // Clear cart items container
            cartItemsContainer.innerHTML = '';
            
            if (cart.length === 0) {
                cartItemsContainer.innerHTML = '<div class="empty-cart">Your cart is empty</div>';
                subtotalElement.textContent = '$0.00';
                discountElement.textContent = '$0.00';
                totalElement.textContent = '$0.00';
                return;
            }
            
            // Add each item to cart display
            cart.forEach(item => {
                const cartItemElement = document.createElement('div');
                cartItemElement.className = 'cart-item';
                
                cartItemElement.innerHTML = `
                    <div class="item-details">
                        <div class="item-name">${item.name}</div>
                        <div class="item-price">$${item.price.toFixed(2)} x ${item.quantity}</div>
                    </div>
                    <button class="remove-item" data-id="${item.id}">Remove</button>
                `;
                
                cartItemsContainer.appendChild(cartItemElement);
            });
            
            // Calculate and display totals
            const totals = calculateTotal();
            subtotalElement.textContent = `$${totals.subtotal.toFixed(2)}`;
            discountElement.textContent = `-$${totals.discount.toFixed(2)}`;
            totalElement.textContent = `$${totals.total.toFixed(2)}`;
            
            // Add event listeners to remove buttons
            document.querySelectorAll('.remove-item').forEach(button => {
                button.addEventListener('click', (e) => {
                    const productId = parseInt(e.target.getAttribute('data-id'));
                    removeFromCart(productId);
                });
            });
        }
        
        // Function to show messages
        function showMessage(text, type) {
            const messageElement = document.getElementById('message');
            messageElement.textContent = text;
            messageElement.className = `message ${type}`;
            
            setTimeout(() => {
                messageElement.textContent = '';
                messageElement.className = 'message';
            }, 3000);
        }
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', () => {
            // Generate product cards
            const productsContainer = document.querySelector('.products');
            
            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                
                productCard.innerHTML = `
                    <img src="${product.image}" alt="${product.name}" class="product-image">
                    <div class="product-info">
                        <h3 class="product-title">${product.name}</h3>
                        <div class="product-price">$${product.price.toFixed(2)}</div>
                        <button class="add-to-cart" data-id="${product.id}">
                            ${product.inStock ? 'Add to Cart' : 'Out of Stock'}
                        </button>
                    </div>
                `;
                
                productsContainer.appendChild(productCard);
            });
            
            // Add event listeners to Add to Cart buttons
            document.querySelectorAll('.add-to-cart').forEach(button => {
                button.addEventListener('click', (e) => {
                    const productId = parseInt(e.target.getAttribute('data-id'));
                    const product = products.find(p => p.id === productId);
                    
                    if (product.inStock) {
                        addToCart(productId);
                    } else {
                        showMessage('This product is out of stock!', 'error');
                    }
                });
            });
            
            // Add event listener to Apply Discount button
            document.querySelector('.apply-discount').addEventListener('click', () => {
                const discountInput = document.querySelector('.discount-input');
                const code = discountInput.value.trim();
                
                if (code) {
                    const discountedTotals = applyDiscount(code);
                    
                    if (discountedTotals.discount > 0) {
                        document.getElementById('subtotal').textContent = `$${discountedTotals.subtotal.toFixed(2)}`;
                        document.getElementById('discount').textContent = `-$${discountedTotals.discount.toFixed(2)}`;
                        document.getElementById('total').textContent = `$${discountedTotals.total.toFixed(2)}`;
                        showMessage(`Discount applied successfully!`, 'success');
                    } else {
                        showMessage('Invalid discount code!', 'error');
                    }
                    
                    discountInput.value = '';
                } else {
                    showMessage('Please enter a discount code!', 'error');
                }
            });
            
            // Add event listener to Checkout button
            document.querySelector('.checkout-btn').addEventListener('click', checkout);
            
            // Hoisting demonstration
            // Using var for a hoisted variable that shows undefined
            console.log("Hoisted variable before declaration:", hoistedVar); // This will show undefined
            var hoistedVar = "This variable was hoisted";
            console.log("Hoisted variable after declaration:", hoistedVar);
        });
    </script>
</body>
</html>